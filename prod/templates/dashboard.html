<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Dashboard - GoEasyChat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<style>
/* Base Styles */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f9f9f9;
}

/* Main Container Styles */
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* Page Content Base Styles */
.page-content {
    display: none;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    min-height: 600px;
    padding: 20px;
}

.page-content.active {
    display: block;
}

/* Responsive container adjustments */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 10px;
    }
    
    .page-content {
        padding: 15px;
        min-height: 400px;
    }
}

/* Header and Navigation */
header {
    background-color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.header-container {
    display: flex;
    flex-direction: column;
    padding: 10px 15px;
    max-width: 1400px;
    margin: 0 auto;
}

/* Top Row with Logo and Logout */
.top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 50px;
}

.logo {
    margin-right: 0;
}

.logo img {
    height: 40px;
}

.user-action {
    display: flex;
    align-items: center;
}

.logout-button {
    color: #333;
    text-decoration: none;
    font-weight: 500;
}

.logout-button:hover {
    color: #0084ff;
}

/* Navigation Container and Scrolling Tabs */
.nav-container {
    display: block;
    width: 100%;
    margin-top: 10px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
}

.nav-container::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

.nav-links {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    min-width: min-content; /* Ensures tabs don't shrink too small */
    width: max-content; /* Ensures all tabs are visible for scrolling */
}

.nav-links li {
    position: relative;
    margin: 0;
    white-space: nowrap;
}

.nav-links a {
    display: block;
    color: #333;
    text-decoration: none;
    padding: 12px 18px;
    font-weight: 500;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: #0084ff;
}

.nav-links a.active {
    color: #0084ff;
    border-bottom: 3px solid #0084ff;
}

/* Dropdown Menu (if needed) */
.dropdown-content {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background-color: white;
    min-width: 200px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    z-index: 1;
    border-radius: 4px;
}

.dropdown-content a {
    padding: 12px 20px;
    display: block;
    color: #333;
    text-decoration: none;
    font-weight: normal;
}

.dropdown-content a:hover {
    background-color: #f5f5f5;
}

.nav-links li:hover .dropdown-content {
    display: block;
}

/* Mobile-specific header and navigation styles */
@media (max-width: 768px) {
    .header-container {
        padding: 10px;
    }
    
    .top-row {
        height: 40px;
    }
    
    .logo img {
        height: 32px;
    }
    
    .nav-links a {
        padding: 10px 16px;
        font-size: 14px;
    }
}

/* Playground Tab Styles */
/* ================================= */
.playground-header {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.playground-header h1 {
    margin: 0 0 10px 0;
    font-size: 24px;
    font-weight: 500;
    margin-right: 20px;
    display: flex;
    align-items: center;
    width: auto;
}

.info-icon {
    margin-left: 8px;
    color: #666;
    cursor: pointer;
    font-size: 18px;
}

/* Bot Selector */
.bot-dropdown {
    position: relative;
    width: auto;
    max-width: 300px;
}

.bot-dropdown-button {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 8px 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
    cursor: pointer;
    justify-content: space-between;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: 100%;
}

.bot-dropdown-button:after {
    content: '▼';
    font-size: 12px;
    margin-left: 10px;
    flex-shrink: 0;
}

.bot-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 250px;
    width: 100%;
    max-width: 300px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    z-index: 1100 !important;
    border-radius: 4px;
    top: 100%;
    left: 0;
}

.bot-dropdown-content a {
    padding: 12px 20px;
    display: block;
    color: #333;
    text-decoration: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

.bot-dropdown-content a:hover {
    background-color: #f5f5f5;
}

.bot-dropdown:hover .bot-dropdown-content {
    display: block;
}

/* Playground Content */
.playground-container {
    width: 100%;
    height: 700px;
    background-color: #f5f5f5;
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    background-image: radial-gradient(circle, #e0e0e0 1px, transparent 1px);
    background-size: 20px 20px;
}

/* Custom chat styles for the playground */
#customer-chatbot .daves-chat-window {
    position: relative !important;
    bottom: auto !important;
    right: auto !important;
    width: 100% !important;
    height: 100% !important;
    max-height: 100% !important;
    border-radius: 8px !important;
    display: block !important;
}

#customer-chatbot .daves-chat-bubble {
    display: none !important;
}

/* Hide the customer chatbot bubble */
#playground-container .daves-chat-bubble {
    display: none !important;
}

#playground-container .daves-chat-window {
    display: flex !important;
    position: relative !important;
    bottom: auto !important;
    right: auto !important;
    width: 100% !important;  
    max-width: 600px !important;
    height: 600px !important;
    max-height: 650px !important;
    border-radius: 8px !important;
    margin: 0 auto !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    background-color: white !important;
    z-index: 1 !important; /* Lower z-index to ensure dropdown appears on top */
}

/* Hide the user's chatbox closing "X" as it can't close so don't show it */
#playground-container .daves-chat-window #daves-close-chat {
    display: none !important;
}

/* Mobile responsive styles for Playground */
@media (max-width: 768px) {
    .playground-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .playground-header h1 {
        margin-bottom: 15px;
        font-size: 22px;
        width: 100%;
    }
    
    .bot-dropdown {
        max-width: 100%;
        width: 100%;
        max-width: 300px;
    }
    
    .bot-dropdown-button {
        width: 100%;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .bot-dropdown-content {
        max-width: 100%;
        width: 100%;
        left: 0;
        right: 0;
    }
    
    .bot-dropdown-content a {
        padding: 12px 15px;
        font-size: 14px;
    }
    
    #playground-container .daves-chat-window {
        width: 100% !important;
        height: 500px !important;
    }
    
    .playground-container {
        height: auto;
        min-height: 550px;
    }
}

/* Connect Tab Styles */
/* ================================= */
.connect-container {
    padding: 30px;
}

.connect-container h2 {
    margin-top: 0;
    margin-bottom: 20px;
}

.code-box {
    background-color: #f5f5f5;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
}

.code-box pre {
    margin: 0;
    white-space: pre-wrap;
    font-family: 'Courier New', Courier, monospace;
}

.copy-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #0084ff;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 8px 15px;
    cursor: pointer;
    font-weight: bold;
}

.copy-btn:hover {
    background-color: #0073e6;
}

/* Mobile responsive styles for Connect tab */
@media (max-width: 768px) {
    .connect-container {
        padding: 20px;
    }
    
    .code-box {
        padding: 15px;
    }
    
    .code-box pre {
        font-size: 14px;
    }
    
    .copy-btn {
        padding: 6px 12px;
        font-size: 14px;
    }
}

/* Sources Tab Styles */
/* ================================= */
.sources-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 20px;
}

.sources-container h2 {
    margin-bottom: 5px;
}

.sources-container p {
    color: #666;
    margin-bottom: 20px;
}

.sources-stats-line {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.retrain-btn {
    margin-left: auto;
    background-color: #1a1a1a;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.upload-box {
    border: 1px dashed #ccc;
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    background-color: #f9f9f9;
    margin-bottom: 20px;
}

#dropzone {
    min-height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 15px;
}

.file-types {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
}

.select-files-btn {
    background-color: #0d6efd;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
}

#no-documents-message {
    text-align: center;
    padding: 30px 0;
}

#no-documents-message h4 {
    margin-bottom: 5px;
}

/* Document card styles */
.document-card {
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: white;
    overflow: hidden;
}

.document-card-header {
    padding: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}

.document-card-title {
    margin: 0;
    font-size: 16px;
    font-weight: 500;
}

.document-type-badge {
    background: #e7f3ff;
    color: #0d6efd;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 12px;
    white-space: nowrap;
}

.document-card-content {
    padding: 15px;
}

.document-metadata {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    color: #666;
    font-size: 14px;
    flex-wrap: wrap;
    gap: 8px;
}

.document-preview {
    background: #f9f9f9;
    padding: 10px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 13px;
    max-height: 100px;
    overflow: hidden;
    margin-top: 10px;
}

.document-card-footer {
    padding: 10px 15px;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
}

.document-card-actions {
    display: flex;
    gap: 10px;
}

.view-doc-btn, .delete-doc-btn {
    padding: 8px 12px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    min-width: 80px;
    text-align: center;
}

.view-doc-btn {
    background-color: #0d6efd;
    color: white;
}

.delete-doc-btn {
    background-color: #dc3545;
    color: white;
}

/* Processing indicator */
.processing-indicator {
    background-color: #d1ecf1;
    color: #0c5460;
    padding: 12px 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.spinner {
    display: inline-block;
    width: 15px;
    height: 15px;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-top-color: #0c5460;
    border-radius: 50%;
    animation: spin 1s infinite linear;
    margin-right: 8px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Upload processing */
.processing-progress {
    width: 100%;
    height: 8px;
    background-color: #e9ecef;
    border-radius: 4px;
    margin-top: 15px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background-color: #0d6efd;
    width: 0%;
    transition: width 0.3s ease;
}

/* Mobile responsive styles for Sources tab */
@media (max-width: 768px) {
    .sources-container {
        padding: 15px;
    }
    
    .sources-stats-line {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .retrain-btn {
        margin-left: 0;
        margin-top: 10px;
        width: 100%;
    }
    
    #dropzone {
        min-height: 120px;
        padding: 10px;
    }
    
    .select-files-btn {
        width: 100%;
    }
    
    .document-card-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .document-type-badge {
        align-self: flex-start;
    }
    
    .document-card-footer {
        flex-direction: column;
    }
    
    .document-card-actions {
        width: 100%;
    }
    
    .view-doc-btn, .delete-doc-btn {
        flex: 1;
    }
}

/* Custom Modal Styles */
/* ================================= */
.custom-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1050;
    overflow: hidden;
    outline: 0;
}

.custom-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1040;
}

.custom-modal-container {
    position: relative;
    z-index: 1060; /* Higher than the overlay */
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 20px;
}

.custom-modal-content {
    position: relative;
    background-color: #fff;
    border-radius: 6px;
    box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    pointer-events: auto;
    display: flex;
    flex-direction: column;
    outline: 0;
}

.custom-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    border-bottom: 1px solid #e9ecef;
}

.custom-modal-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 500;
}

.custom-modal-close {
    background: transparent;
    border: 0;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    margin: -15px -15px -15px auto;
    color: #999;
}

.custom-modal-close:hover {
    color: #333;
}

.custom-modal-body {
    padding: 20px;
    max-height: 70vh;
    overflow-y: auto;
}

.custom-modal-footer {
    display: flex;
    justify-content: flex-end;
    padding: 15px 20px;
    border-top: 1px solid #e9ecef;
}

.btn-cancel {
    background-color: #6c757d;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
}

.btn-delete {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.btn-cancel:hover {
    background-color: #5a6268;
}

.btn-delete:hover {
    background-color: #c82333;
}

/* Mobile responsive styles for modal */
@media (max-width: 768px) {
    .custom-modal-content {
        max-width: 100%;
        margin: 0 10px;
    }
    
    .custom-modal-body {
        padding: 15px;
    }
    
    .custom-modal-header,
    .custom-modal-footer {
        padding: 12px 15px;
    }
}

/* Chat Logs Styles */
/* ================================= */
.chat-logs-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.chat-logs-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.chat-logs-content {
    display: flex;
    height: 650px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    background-color: white;
}

.chat-logs-threads {
    width: 35%;
    border-right: 1px solid #e0e0e0;
    overflow-y: auto;
    background-color: #f9f9f9;
}

.chat-logs-messages {
    width: 65%;
    overflow-y: auto;
    background-color: white;
    position: relative;
}

.thread-item {
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
    cursor: pointer;
    transition: background-color 0.2s;
}

.thread-item:hover {
    background-color: #f0f0f0;
}

.thread-item.active {
    background-color: #e9ecef;
    border-left: 3px solid #0d6efd;
}

.thread-preview {
    font-size: 14px;
    color: #666;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-top: 5px;
}

.thread-time {
    font-size: 12px;
    color: #888;
    margin-top: 5px;
}

.message-container {
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.chat-message {
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    max-width: 80%;
}

.chat-message.user {
    align-self: flex-end;
    margin-left: auto;
}

.chat-message.assistant {
    align-self: flex-start;
    margin-right: auto;
}

.message-bubble {
    padding: 10px 15px;
    border-radius: 15px;
    position: relative;
    word-wrap: break-word;
}

.message-bubble.user {
    background-color: #0d6efd;
    color: white;
    border-top-right-radius: 5px;
}

.message-bubble.assistant {
    background-color: #e9ecef;
    color: #212529;
    border-top-left-radius: 5px;
    padding-left: 40px;
}

.message-bubble.assistant::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 10px;
    width: 24px;
    height: 24px;
    background-image: url('https://res.cloudinary.com/dd19jhkar/image/upload/v1735504762/enfadxyhjtjkwdivbuw4.png');
    background-size: cover;
    background-position: center;
    border-radius: 50%;
}

.message-time {
    font-size: 11px;
    margin-top: 3px;
    color: #888;
    align-self: flex-start;
}

.user .message-time {
    align-self: flex-end;
}

/* Loading indicators */
#threadsLoadingIndicator,
#messagesLoadingIndicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px;
    height: 100%;
}

#noThreadsMessage,
#noMessagesMessage {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 30px;
    height: 100%;
    color: #666;
}

#noThreadsMessage h4,
#noMessagesMessage h4 {
    margin-bottom: 10px;
    color: #333;
}

/* Mobile responsive styles for Chat Logs */
@media (max-width: 768px) {
    .chat-logs-container {
        padding: 15px;
    }
    
    .chat-logs-content {
        flex-direction: column;
        height: auto;
        min-height: 700px;
    }
    
    .chat-logs-threads,
    .chat-logs-messages {
        width: 100%;
        height: 350px;
    }
    
    .chat-logs-threads {
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .message-container {
        padding: 15px;
    }
    
    .message-bubble {
        padding: 8px 12px;
    }
    
    .message-bubble.assistant {
        padding-left: 35px;
    }
    
    .message-bubble.assistant::before {
        width: 20px;
        height: 20px;
        left: 8px;
        top: 8px;
    }
    
    .thread-item {
        padding: 12px;
    }
    
    .thread-preview {
        font-size: 13px;
    }
    
    .thread-time {
        font-size: 11px;
    }
    
    .chat-message {
        max-width: 95%;
    }
}

/* Leads Tab Styles */
/* ================================= */
.leads-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

#exportLeadsBtn {
    background-color: #0d6efd;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    white-space: nowrap;
}

#exportLeadsBtn:hover {
    background-color: #0b5ed7;
}

#leadsErrorMessage {
    background-color: #f8d7da;
    color: #721c24;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

#leadsLoadingIndicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px;
    margin: 20px 0;
}

#noLeadsMessage {
    background-color: #f9f9f9;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    margin: 20px 0;
}

#noLeadsMessage h4 {
    margin-bottom: 10px;
    color: #333;
}

#leadsTable {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

#leadsTable th {
    position: relative;
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
}

#leadsTable th, 
#leadsTable td {
    padding: 12px 15px;
    border-bottom: 1px solid #e0e0e0;
    vertical-align: middle;
}

#leadsTable thead th {
    background-color: #f9f9f9;
    font-weight: 600;
    color: #333;
    text-transform: uppercase;
    font-size: 13px;
}

#leadsTable th:hover {
    background-color: #f5f5f5;
}

#leadsTable th .sort-icon {
    font-size: 12px;
    margin-left: 5px;
    opacity: 0.6;
}

#leadsTable th.sort-asc .sort-icon,
#leadsTable th.sort-desc .sort-icon {
    opacity: 1;
}

#leadsTable tbody tr:last-child td {
    border-bottom: none;
}

#leadsTable tbody tr:hover {
    background-color: #f5f5f5;
    transition: background-color 0.3s ease;
}

.lead-data-cell {
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.delete-lead-btn {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
}

.delete-lead-btn:hover {
    background-color: #c82333;
}

/* Card-style mobile view */
.lead-card {
    display: none;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    padding: 15px;
}

.lead-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 10px;
}

.lead-card-name {
    font-weight: 500;
    font-size: 16px;
}

.lead-card-date {
    color: #666;
    font-size: 13px;
}

.lead-card-body {
    margin-bottom: 15px;
}

.lead-card-field {
    margin-bottom: 8px;
}

.lead-card-label {
    color: #666;
    font-size: 13px;
    display: block;
    margin-bottom: 3px;
}

.lead-card-value {
    font-size: 15px;
    word-break: break-word;
}

.lead-card-actions {
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid #eee;
    padding-top: 10px;
}

/* Mobile responsive styles for Leads tab */
@media (max-width: 768px) {
    .leads-container {
        padding: 15px;
    }
    
    .header-actions {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .header-actions h2 {
        margin-bottom: 10px;
    }
    
    #exportLeadsBtn {
        width: 100%;
    }
    
    #leadsTable {
        display: block;
        width: 100%;
        overflow-x: auto;
        white-space: nowrap;
        box-shadow: none;
        border: 1px solid #e0e0e0;
    }
    
    #leadsTable th, 
    #leadsTable td {
        padding: 10px 12px;
    }
    
    /* Enable card view for very small screens */
    @media (max-width: 480px) {
        #leadsTable {
            display: none;
        }
        
        .lead-card {
            display: block;
        }
    }
}

/* Settings Tab Styles */
/* ================================= */
.settings-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.settings-header {
    margin-bottom: 20px;
    font-size: 24px;
    font-weight: 500;
}

.settings-layout {
    display: flex;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    overflow: hidden;
    min-height: 600px;
}

.settings-nav {
    width: 250px;
    border-right: 1px solid #e0e0e0;
    background-color: #f9f9f9;
    flex-shrink: 0;
}

.settings-menu {
    list-style: none;
    padding: 0;
    margin: 0;
    position: sticky;
    top: 0;
}

.settings-menu li {
    margin: 0;
    padding: 0;
}

.settings-nav-item {
    display: block;
    padding: 15px 20px;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: background 0.2s;
}

.settings-nav-item:hover {
    background-color: #f0f0f0;
    color: #0084ff;
}

.settings-nav-item.active {
    background-color: #e9ecef;
    border-left: 3px solid #0084ff;
    font-weight: 500;
    color: #0084ff;
}

.settings-content {
    flex: 1;
    padding: 30px;
    min-height: 600px;
    overflow-x: auto;
}

.settings-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 300px;
}

.settings-error {
    background-color: #f8d7da;
    color: #721c24;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.settings-form {
    max-width: 100%;
}

.settings-form h3 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 18px;
    color: #333;
}

.settings-description {
    color: #666;
    margin-bottom: 20px;
    font-size: 14px;
}

.settings-note {
    color: #666;
    font-size: 13px;
    font-style: italic;
    margin-top: 5px;
}

.form-group {
    margin-bottom: 20px;
}

.settings-textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 14px;
    resize: vertical;
    min-height: 100px;
}

.settings-text-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.char-counter {
    text-align: right;
    font-size: 12px;
    color: #666;
    margin-top: 5px;
}

.color-input-container {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.color-input {
    flex: 1;
    min-width: 200px;
}

.color-preview {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    border: 1px solid #ddd;
    flex-shrink: 0;
}

.color-presets {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
}

.color-preset {
    width: 30px;
    height: 30px;
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid #ddd;
    transition: transform 0.2s;
}

.color-preset:hover {
    transform: scale(1.1);
}

.radio-option {
    margin-bottom: 15px;
}

.radio-option label {
    margin-left: 8px;
    cursor: pointer;
}

.icon-preview-container {
    text-align: center;
    margin-bottom: 20px;
}

.icon-preview {
    max-width: 250px;
    max-height: 250px;
    border: 1px solid #ddd;
    border-radius: 8px;
}

.icon-placeholder {
    width: 100%;
    height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f5;
    border: 1px dashed #ddd;
    border-radius: 8px;
    color: #666;
}

.settings-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.settings-save-btn {
    background-color: #0084ff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    min-width: 100px;
}

.settings-save-btn:hover {
    background-color: #0073e6;
}

.settings-test-btn {
    background-color: #6c757d;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    min-width: 100px;
}

.settings-test-btn:hover {
    background-color: #5a6268;
}

.settings-message {
    padding: 10px;
    border-radius: 4px;
    margin-top: 15px;
    display: none;
}

.settings-message.error {
    background-color: #f8d7da;
    color: #721c24;
    display: block;
}

.settings-message.success {
    background-color: #d4edda;
    color: #155724;
    display: block;
}

.settings-message.info {
    background-color: #e7f3ff;
    color: #0c5460;
    display: block;
}

.webhook-test-results {
    margin-top: 30px;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    background-color: #f9f9f9;
}

.webhook-test-results h4 {
    margin-top: 0;
    margin-bottom: 15px;
}

.webhook-payload {
    margin-top: 15px;
}

.webhook-payload pre {
    background-color: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px;
    font-family: monospace;
    font-size: 13px;
    overflow-x: auto;
    max-height: 300px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
}

/* Mobile navigation for settings */
.settings-mobile-nav-toggle {
    display: none;
    width: 100%;
    padding: 12px 15px;
    background-color: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    margin-bottom: 15px;
    text-align: left;
    position: relative;
    font-weight: 500;
    cursor: pointer;
}

.settings-mobile-nav-toggle:after {
    content: '▼';
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
}

/* Mobile responsive styles for Settings tab */
@media (max-width: 768px) {
    .settings-container {
        padding: 15px;
    }
    
    .settings-layout {
        flex-direction: column;
    }
    
    .settings-mobile-nav-toggle {
        display: block;
    }
    
    .settings-nav {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
        display: none;
    }
    
    .settings-nav.active {
        display: block;
    }
    
    .settings-content {
        padding: 15px;
    }
    
    .settings-actions {
        flex-direction: column;
    }
    
    .settings-save-btn,
    .settings-test-btn {
        width: 100%;
    }
    
    .color-input-container {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .color-preview {
        margin-left: 0;
        margin-top: 10px;
    }
    
    .settings-header {
        font-size: 20px;
    }
    
    .settings-form h3 {
        font-size: 16px;
    }
    
    .webhook-payload pre {
        font-size: 12px;
    }
}

/* Support Chat and Utility Styles */
/* ================================= */

/* Support chat bubble iframe container */
#support-chat-container {
    position: fixed;
    bottom: 0;
    right: 0;
    z-index: 1000;
    width: 100px;
    height: 100px;
}

/* Placeholder Content */
.placeholder-content {
    padding: 40px;
    text-align: center;
    color: #666;
}

/* Loading spinner animation */
@keyframes spin {
    to { transform: rotate(360deg); }
}

.spinner {
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 3px solid rgba(0, 0, 0, 0.1);
    border-top-color: #007bff;
    border-radius: 50%;
    animation: spin 1s infinite linear;
}

/* Mobile responsive styles */
@media (max-width: 768px) {
    .spinner {
        width: 30px;
        height: 30px;
        border-width: 2px;
    }
    
    .placeholder-content {
        padding: 20px;
    }
}

</style>
</head>
<body>

<header>
    <div class="header-container">
        <div class="top-row">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/logo_120x40.png') }}" alt="GoEasyChat Logo">
            </div>
            <div class="user-action">
                <a href="{{ url_for('auth.logout') }}" class="logout-button">Logout</a>
            </div>
        </div>
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="javascript:void(0);" class="active" onclick="openPage('playground')">Playground</a></li>
                <li><a href="javascript:void(0);" onclick="openPage('connect')">Connect</a></li>
                <li><a href="javascript:void(0);" onclick="openPage('sources')">Sources</a></li>
                <li><a href="javascript:void(0);" onclick="openPage('chat-logs')">Chat Logs</a></li>
                <li><a href="javascript:void(0);" onclick="openPage('leads')">Leads</a></li>
                <li><a href="javascript:void(0);" onclick="openPage('settings')">Settings</a></li>
            </ul>
        </div>
    </div>
</header>

    <main class="dashboard-container">
        <!-- Playground Page -->
        <div id="playground" class="page-content active">
            <div class="playground-header">
                <h1>
                    Playground
                    <span class="info-icon" title="Test and interact with your chatbot">ⓘ</span>
                </h1>
                <div class="bot-dropdown">
                    <div class="bot-dropdown-button">
                        <span id="selected-bot-name">
                            {% if chatbots|length > 0 %}
                                {{ chatbots[0].company_url }}
                            {% else %}
                                No chatbots available
                            {% endif %}
                        </span>
                    </div>
                    <div class="bot-dropdown-content">
                        {% for chatbot in chatbots %}
                            <a href="javascript:void(0);" onclick="selectBot('{{ chatbot.chatbot_id }}', '{{ chatbot.company_url }}')">{{ chatbot.company_url }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div id="playground-container" class="playground-container">
                <!-- Customer's chatbot will be loaded here -->
                <div id="customer-chatbot"></div>
            </div>
        </div>

        <!-- Connect Page -->
        <div id="connect" class="page-content">
            <div class="connect-container">
                <h2>Embed Your Chatbot</h2>
                <p>Copy the code below and paste it into your website's HTML to embed your chatbot:</p>
                
                <div class="code-box">
                    <pre><code id="embed-code">
                &lt;script&gt;
                window.davesEasyChatConfig = {
                    chatbotId: "{% if chatbots|length > 0 %}{{ chatbots[0].chatbot_id }}{% else %}YOUR_CHATBOT_ID{% endif %}",
                    baseUrl: "{{ request.url_root.rstrip('/') }}"
                };
                &lt;/script&gt;
                &lt;script src="{{ request.url_root }}static/js/chatbot-embed.js" defer&gt;&lt;/script&gt;
                    </code></pre>
                    <button class="copy-btn" onclick="copyEmbedCode()">Copy</button>
                </div>
                
                <h3>Installation Instructions</h3>
                <p>1. Copy the code above by clicking the "Copy" button</p>
                <p>2. Paste the code into your website's HTML, just before the closing &lt;/body&gt; tag</p>
                <p>3. Save your changes and reload your website to see your chatbot in action</p>
            </div>
        </div>

        <!-- Sources Page -->
        <div id="sources" class="page-content">
            <div class="sources-container">
                <h2>Knowledge Sources</h2>
                <p>Upload documents to enhance your chatbot's knowledge</p>
                <!--
                <div class="sources-stats-line">
                    <span id="total-files">0</span> Files / <span id="total-size">0 KB</span> of <span id="max-size">33 MB</span>
                    <button id="retrain-agent-btn" class="retrain-btn">Retrain agent</button>
                </div>
                -->

                <div class="upload-box">
                    <div id="dropzone">
                        <p>Drag & drop files here, or click to select files</p>
                        <p class="file-types">Supported File Types: .pdf, .doc, .docx, .txt</p>
                        <button id="select-files-btn" class="select-files-btn">Select Files</button>
                        <input type="file" id="file-upload-input" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                    </div>
                </div>

                <div id="document-processing" style="display: none;"></div>

                <div id="no-documents-message">
                    <h4>No documents found</h4>
                    <p>Upload documents using the area above</p>
                </div>
                
                <div id="documents-list">
                    <!-- Documents will be loaded here -->
                </div>
            </div>

            <!-- Document Preview Modal -->
            <div id="documentModal" class="custom-modal" style="display: none;">
                <div class="custom-modal-overlay"></div>
                <div class="custom-modal-container">
                    <div class="custom-modal-content">
                        <div class="custom-modal-header">
                            <h5 class="custom-modal-title" id="documentTitle">Document Content</h5>
                            <button type="button" class="custom-modal-close" onclick="closeDocumentModal()">&times;</button>
                        </div>
                        <div class="custom-modal-body">
                            <div id="documentContent" style="white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></div>
                        </div>
                        <div class="custom-modal-footer">
                            <button type="button" class="btn-cancel" onclick="closeDocumentModal()">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div id="deleteConfirmModal" class="custom-modal" style="display: none;">
                <div class="custom-modal-overlay"></div>
                <div class="custom-modal-container">
                    <div class="custom-modal-content">
                        <div class="custom-modal-header">
                            <h5 class="custom-modal-title">Confirm Delete</h5>
                            <button type="button" class="custom-modal-close" onclick="closeDeleteModal()">&times;</button>
                        </div>
                        <div class="custom-modal-body">
                            <p>Are you sure you want to delete this document?</p>
                            <p>This will permanently remove the document and all associated knowledge from your chatbot.</p>
                        </div>
                        <div class="custom-modal-footer">
                            <button type="button" class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                            <button type="button" class="btn-delete" id="confirmDeleteBtn">Delete Document</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Logs Page -->
        <div id="chat-logs" class="page-content">
            <div class="chat-logs-container">
                <div class="chat-logs-header d-flex justify-content-between align-items-center mb-4" style="margin-top: -40px;">
                    <h2>Chat Logs</h2>
                </div>
                
                <div class="chat-logs-content">
                    <div class="chat-logs-threads">
                        <div id="threadsLoadingIndicator" style="text-align: center; padding: 30px; display: none;">
                            <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto;"></div>
                            <p class="mt-3">Loading threads...</p>
                        </div>
                        
                        <div id="noThreadsMessage" style="text-align: center; padding: 50px 20px; display: none;">
                            <h4>No chat threads found</h4>
                            <p class="text-muted">When visitors chat with your bot, conversations will appear here.</p>
                        </div>
                        
                        <div id="threadsList">
                            <!-- Threads will be loaded here dynamically -->
                        </div>
                    </div>
                    
                    <div class="chat-logs-messages">
                        <div id="messagesLoadingIndicator" style="text-align: center; padding: 30px; display: none;">
                            <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto;"></div>
                            <p class="mt-3">Loading conversation...</p>
                        </div>
                        
                        <div id="noMessagesMessage" style="text-align: center; padding: 50px 20px; display: none;">
                            <h4>Select a conversation</h4>
                            <p class="text-muted">Choose a thread from the left to view the conversation.</p>
                        </div>
                        
                        <div id="messagesList">
                            <!-- Messages will be loaded here dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leads Page -->
        <div id="leads" class="page-content">
            <div class="leads-container">
                <div class="header-actions d-flex justify-content-between align-items-center mb-4">
                    <h2>Leads</h2>
                    <button id="exportLeadsBtn" class="btn btn-primary">
                        Export to CSV
                    </button>
                </div>
                
                <div id="leadsErrorMessage" class="alert alert-danger" style="display: none;"></div>
                
                <div id="leadsLoadingIndicator" style="text-align: center; padding: 30px; display: none;">
                    <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                    <p class="mt-3">Loading leads...</p>
                </div>
                
                <div id="noLeadsMessage" style="text-align: center; padding: 50px 20px; background-color: #f9f9f9; border-radius: 8px; display: none;">
                    <h4>No leads found</h4>
                    <p class="text-muted">When visitors fill out the lead form in your chatbot, their information will appear here.</p>
                </div>
                
                <table id="leadsTable" class="table table-striped" style="display: none;">
                    <thead>
                        <tr>
                            <th data-sort="name">Name <span class="sort-icon">↕️</span></th>
                            <th data-sort="email">Email <span class="sort-icon">↕️</span></th>
                            <th data-sort="phone">Phone <span class="sort-icon">↕️</span></th>
                            <th data-sort="created_at">Date <span class="sort-icon">↕️</span></th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody">
                        <!-- Leads will be loaded dynamically here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Page -->
        <!-- Settings Page -->
        <div id="settings" class="page-content">
            <div class="settings-container">
                <h2 class="settings-header">Settings</h2>
                <div class="settings-layout">
                    <div class="settings-nav">
                        <ul class="settings-menu">
                            <li><a href="#" class="settings-nav-item active" data-setting="system-prompt">System Prompt</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="chat-title">Chat Title</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="chat-subtitle">Chat Subtitle</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="lead-form-title">Lead Form Title</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="primary-color">Primary Color</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="accent-color">Accent Color</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="icon-image">Icon Image</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="show-lead-form">Show Lead Form</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="webhook-url">Webhook URL</a></li>
                            <li><a href="#" class="settings-nav-item" data-setting="webhook-triggers">Webhook Triggers</a></li>
                        </ul>
                    </div>
                    <div class="settings-content">
                        <div class="settings-content-area">
                            <!-- Setting content will be loaded here -->
                            <div class="settings-loading">
                                <div class="spinner"></div>
                                <p>Loading settings...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>

    // Update document stats
    function updateDocumentStats(documents) {
        const totalFilesEl = document.getElementById('total-files');
        const totalSizeEl = document.getElementById('total-size');
        
        if (!totalFilesEl || !totalSizeEl) return;
        
        const count = documents.length;
        totalFilesEl.textContent = count;
        
        if (count > 0) {
            // Calculate total size (rough estimate)
            let totalSize = 0;
            documents.forEach(doc => {
                totalSize += doc.content ? doc.content.length : 0;
            });
            
            // Format size
            if (totalSize > 1024 * 1024) {
                totalSizeEl.textContent = Math.round(totalSize / (1024 * 1024) * 10) / 10 + ' MB';
            } else {
                totalSizeEl.textContent = Math.round(totalSize / 1024) + ' KB';
            }
        } else {
            totalSizeEl.textContent = '0 KB';
        }
    }
    

        // Main function to load documents
        function loadDocuments() {
            const documentsList = document.getElementById('documents-list');
            const noDocumentsMessage = document.getElementById('no-documents-message');
            
            if (!documentsList) return;
            
            // Get the currently selected chatbot ID
            const selectedBotName = document.getElementById('selected-bot-name');
            let activeChatbotId = '';
            
            if (selectedBotName) {
                const chatbotOptions = document.querySelectorAll('.bot-dropdown-content a');
                for (let option of chatbotOptions) {
                    if (option.textContent.trim() === selectedBotName.textContent.trim()) {
                        const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                        if (match && match[1]) {
                            activeChatbotId = match[1];
                            break;
                        }
                    }
                }
            }
            
            // Show loading state
            documentsList.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div class="spinner" style="width: 30px; height: 30px;"></div>
                    <p>Loading your documents...</p>
                </div>
            `;
            
            // Fetch documents from the server
            fetch('/documents/user-documents')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Filter documents to only show those for the active chatbot
                    let filteredDocuments = data.documents || [];
                    if (activeChatbotId) {
                        filteredDocuments = filteredDocuments.filter(doc => doc.chatbot_id === activeChatbotId);
                    }
                    
                    // Update document stats
                    updateDocumentStats(filteredDocuments);
                    
                    // Clear the container
                    documentsList.innerHTML = '';
                    
                    if (filteredDocuments.length > 0) {
                        // Hide the "no documents" message
                        if (noDocumentsMessage) {
                            noDocumentsMessage.style.display = 'none';
                        }
                        
                        // Add each document to the list
                        filteredDocuments.forEach(doc => {
                            documentsList.appendChild(createDocumentElement(doc));
                        });
                    } else {
                        // Show the "no documents" message
                        if (noDocumentsMessage) {
                            noDocumentsMessage.style.display = 'block';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading documents:', error);
                    documentsList.innerHTML = `
                        <div style="text-align: center; padding: 30px;">
                            <p style="color: red;">Error loading documents. Please try again.</p>
                        </div>
                    `;
                });
        }


        // Page navigation
        function openPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active nav link
            const navLinks = document.querySelectorAll('.nav-links > li > a');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(pageId)) {
                    link.classList.add('active');
                }
            });
            
            // If navigating to Sources tab, reload documents to apply the current chatbot filter
            if (pageId === 'sources') {
                loadDocuments();
            }
            
            // If navigating to Playground tab, reload the chatbot to reflect any settings changes
            if (pageId === 'playground') {
                // Get the currently selected chatbot ID
                const selectedBotName = document.getElementById('selected-bot-name');
                if (selectedBotName) {
                    const chatbotOptions = document.querySelectorAll('.bot-dropdown-content a');
                    for (let option of chatbotOptions) {
                        if (option.textContent.trim() === selectedBotName.textContent.trim()) {
                            const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                            if (match && match[1]) {
                                // Reload the chatbot with the current ID
                                loadCustomerChatbot(match[1]);
                                break;
                            }
                        }
                    }
                }
            }
        }
        
        // Copy embed code
        function copyEmbedCode() {
            const embedCode = document.getElementById('embed-code').innerText;
            navigator.clipboard.writeText(embedCode).then(() => {
                alert('Embed code copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy embed code. Please try again.');
            });
        }
        
        // Bot selection
        function selectBot(chatbotId, companyUrl) {
            document.getElementById('selected-bot-name').textContent = companyUrl;
            
            // Update embed code
            const embedCodeElement = document.getElementById('embed-code');
            if (embedCodeElement) {
                embedCodeElement.innerHTML = 
                    '&lt;script&gt;\n' +
                    'window.davesEasyChatConfig = {\n' +
                    '    chatbotId: "' + chatbotId + '",\n' +
                    '    baseUrl: "' + window.location.origin + '"\n' +
                    '};\n' +
                    '&lt;/script&gt;\n' +
                    '&lt;script src="' + window.location.origin + '/static/js/chatbot-embed.js" defer&gt;&lt;/script&gt;';
            }
            
            // Load the selected chatbot
            loadCustomerChatbot(chatbotId);
            
            // If the Sources tab is currently active, refresh its documents
            if (document.getElementById('sources').classList.contains('active')) {
                loadDocuments();
            }
        }
        
        // Load the customer's chatbot in the playground
        function loadCustomerChatbot(chatbotId) {
            // Remove any existing chatbot script and config
            const existingScripts = document.querySelectorAll('.customer-bot-script');
            existingScripts.forEach(script => script.remove());
            
            // Clear the container
            const container = document.getElementById('customer-chatbot');
            container.innerHTML = '';
            
            // Create a script to initialize the chatbot with custom config
            var chatbotConfig = document.createElement('script');
            chatbotConfig.className = 'customer-bot-script';
            chatbotConfig.innerHTML = 'window.davesEasyChatConfig = { chatbotId: "' + chatbotId + '", mountTo: "#customer-chatbot", readyToLoad: true };';
            document.head.appendChild(chatbotConfig);
            
            // Create a script to load the chatbot JavaScript
            var chatbotScript = document.createElement('script');
            chatbotScript.className = 'customer-bot-script'; 
            chatbotScript.src = "{{ url_for('static', filename='js/chatbot-embed.js') }}";
            document.body.appendChild(chatbotScript);
            
            // After the script loads, apply our own CSS to hide bubble and show window
            chatbotScript.onload = function() {
                // Wait a moment for the chatbot to initialize
                setTimeout(function() {
                    // Force the chat window to be visible and the bubble to be hidden
                    const chatBubble = document.querySelector('#customer-chatbot .daves-chat-bubble');
                    const chatWindow = document.querySelector('#customer-chatbot .daves-chat-window');
                    
                    if (chatBubble) {
                        chatBubble.style.display = 'none';
                    }
                    
                    if (chatWindow) {
                        chatWindow.classList.remove('d-none');
                        chatWindow.style.display = 'flex';
                        chatWindow.style.position = 'relative';
                        chatWindow.style.bottom = 'auto';
                        chatWindow.style.right = 'auto';
                        chatWindow.style.width = '100%';
                        chatWindow.style.height = '100%';
                        chatWindow.style.maxHeight = '700px';
                        chatWindow.style.borderRadius = '8px';
                        
                        // Add the welcome message if it doesn't exist
                        setTimeout(function() {
                            const messagesContainer = chatWindow.querySelector('#daves-chat-messages');
                            if (messagesContainer && messagesContainer.childNodes.length === 0) {
                                // Create and add the welcome message
                                const welcomeMsg = document.createElement('div');
                                welcomeMsg.className = 'daves-chat-message assistant';
                                welcomeMsg.innerHTML = 'Hi there! 👋 How can I help you?';
                                messagesContainer.appendChild(welcomeMsg);
                            }
                        }, 300);
                    }
                }, 100);
            };
        }
        
       
        // Initialize when the page loads
        document.addEventListener('DOMContentLoaded', function() {
        // Load and select the first chatbot by default
        {% if chatbots|length > 0 %}
            // Use selectBot instead of just loadCustomerChatbot to properly set it as active
            selectBot('{{ chatbots[0].chatbot_id }}', '{{ chatbots[0].company_url }}');
        {% endif %}

        });
    </script>

<script>

// Custom Modal Functions
// Global variables for document management
let activeDocId = null;
let activeChatbotId = null;

// Custom Modal Functions
function showDeleteModal() {
    const modal = document.getElementById('deleteConfirmModal');
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent body scrolling
    }
}

function closeDeleteModal() {
    const modal = document.getElementById('deleteConfirmModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // Restore body scrolling
    }
}

function showDocumentModal() {
    const modal = document.getElementById('documentModal');
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent body scrolling
    }
}

function closeDocumentModal() {
    const modal = document.getElementById('documentModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // Restore body scrolling
    }
}

// Create a document element with debug console logs
function createDocumentElement(doc) {
    const elem = document.createElement('div');
    elem.className = 'document-card';
    
    // Format the date
    const createdDate = new Date(doc.created_at);
    const formattedDate = createdDate.toLocaleDateString('en-US', {
        year: 'numeric', month: 'short', day: 'numeric'
    });
    
    elem.innerHTML = `
        <div style="padding: 15px; border-bottom: 1px solid #eee;">
            <div style="display: flex; justify-content: space-between;">
                <h5 style="margin: 0;">${doc.doc_name}</h5>
                <span style="background: #e7f3ff; color: #0d6efd; padding: 2px 8px; border-radius: 10px; font-size: 12px;">
                    ${doc.doc_type === 'scraped_content' ? 'Website Content' : 'Uploaded Document'}
                </span>
            </div>
        </div>
        <div style="padding: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #666; font-size: 14px;">
                <span>Added: ${formattedDate}</span>
                <span>Vectors: ${doc.vectors_count || 0}</span>
            </div>
            <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 13px; max-height: 100px; overflow: hidden;">
                ${doc.content ? doc.content.substring(0, 300) + (doc.content.length > 300 ? '...' : '') : 'No preview available'}
            </div>
        </div>
        <div style="padding: 10px 15px; border-top: 1px solid #eee; display: flex; justify-content: space-between;">
            <button class="view-doc-btn" style="background: #0d6efd; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                View Content
            </button>
            <button class="delete-doc-btn" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Delete
            </button>
        </div>
    `;
    
    // Add event listeners to buttons
    const viewBtn = elem.querySelector('.view-doc-btn');
    const deleteBtn = elem.querySelector('.delete-doc-btn');
    
    if (viewBtn) {
        viewBtn.addEventListener('click', function() {
            console.log("View button clicked for doc:", doc.doc_id);
            viewDocument(doc.doc_id);
        });
    }
    
    if (deleteBtn) {
        deleteBtn.addEventListener('click', function(e) {
            console.log("Delete button clicked for doc:", doc.doc_id);
            e.preventDefault();
            e.stopPropagation();
            
            // Set the active document for deletion
            activeDocId = doc.doc_id;
            activeChatbotId = doc.chatbot_id;
            
            // Show our custom modal
            showDeleteModal();
        });
    }
    
    return elem;
}

// Sources Tab JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on the Sources tab
    const sourcesTab = document.getElementById('sources');
    if (!sourcesTab) return;
    
    // File upload elements
    const fileInput = document.getElementById('file-upload-input');
    const selectFilesBtn = document.getElementById('select-files-btn');
    const dropzone = document.getElementById('dropzone');
    const uploadBox = document.querySelector('.upload-box');
    
    // Initialize the file upload button
    if (selectFilesBtn && fileInput) {
        selectFilesBtn.addEventListener('click', function() {
            fileInput.click();
        });
    }
    
    // File input change handler
    fileInput.addEventListener('change', function() {
        if (fileInput.files && fileInput.files.length > 0) {
            uploadFiles(fileInput.files);
            // Reset the file input value
            fileInput.value = '';
        }
    });

    
    // Drag and drop handlers
    if (uploadBox) {
        uploadBox.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = '#0d6efd';
            this.style.backgroundColor = '#f0f8ff';
        });
        
        uploadBox.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = '#ccc';
            this.style.backgroundColor = '#f9f9f9';
        });
        
        uploadBox.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = '#ccc';
            this.style.backgroundColor = '#f9f9f9';
            
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                uploadFiles(e.dataTransfer.files);
            }
        });
    }
    
    // Retrain agent button
    const retrainBtn = document.getElementById('retrain-agent-btn');
    if (retrainBtn) {
        retrainBtn.addEventListener('click', function() {
            retrainAgent();
        });
    }
    
    // Delete confirmation button
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function() {
            if (activeDocId && activeChatbotId) {
                deleteDocument(activeDocId, activeChatbotId);
                closeDeleteModal();
            }
        });
    }
    
    // Load documents when the tab is shown
    loadDocumentsWhenVisible();
    
    // Add listener for tab navigation
    document.addEventListener('click', function(e) {
        const sourcesTabLink = document.querySelector('a[onclick="openPage(\'sources\')"]');
        if (e.target === sourcesTabLink || (sourcesTabLink && sourcesTabLink.contains(e.target))) {
            loadDocumentsWhenVisible();
        }
    });
    
    // Function to load documents when tab becomes visible
    function loadDocumentsWhenVisible() {
        if (sourcesTab.classList.contains('active')) {
            loadDocuments();
        }
    }

// Upload files
function uploadFiles(files) {
    if (!files || files.length === 0) return;
    
    // Get the current chatbot ID
    const selectedBotName = document.getElementById('selected-bot-name');
    let chatbotId = '';
    
    if (selectedBotName) {
        const chatbotOptions = document.querySelectorAll('.bot-dropdown-content a');
        for (let option of chatbotOptions) {
            if (option.textContent.trim() === selectedBotName.textContent.trim()) {
                const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                if (match && match[1]) {
                    chatbotId = match[1];
                    break;
                }
            }
        }
        
        if (!chatbotId && chatbotOptions.length > 0) {
            // Try to get the first chatbot ID as fallback
            const match = chatbotOptions[0].getAttribute('onclick').match(/selectBot\('([^']+)'/);
            if (match && match[1]) {
                chatbotId = match[1];
            }
        }
    }
    
    if (!chatbotId) {
        alert('Error: No chatbot selected for this document.');
        return;
    }
    
    // Hide the dropzone and show the processing indicator with unified UI
    const uploadBox = document.querySelector('.upload-box');
    if (uploadBox) uploadBox.style.display = 'none';
    
    // Get the processing element and show simplified UI
    const processingEl = document.getElementById('document-processing');
    if (processingEl) {
        processingEl.innerHTML = `
            <div class="processing-indicator">
                <div style="text-align: center; padding: 20px;">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 15px;"></div>
                    <h4 style="margin-bottom: 15px;">${files[0].name}</h4>
                    <div style="height: 1px; background: #cce5ff; margin: 15px auto; width: 80%;"></div>
                    <p><strong>Retraining your bot, please stand by...</strong></p>
                    <p style="color: #666;">This may take a minute.</p>
                </div>
            </div>
        `;
        processingEl.style.display = 'block';
    }
    
    // Create FormData
    const formData = new FormData();
    formData.append('document', files[0]);
    formData.append('chatbot_id', chatbotId);
    
    // Store the file name
    const fileName = files[0].name;
    
    // Create and send request
    const xhr = new XMLHttpRequest();
    
    // Handle completion
    xhr.onload = function() {
        if (xhr.status === 200) {
            try {
                const response = JSON.parse(xhr.responseText);
                console.log('Server response:', response); // Debugging statement
                if (response.success) {
                    // Start polling for processing completion
                    checkDocumentProcessingImproved(response.doc_id, uploadBox, fileName);
                    // Reset the file input value after successful upload
                    document.getElementById('file-upload-input').value = '';
                } else {
                    alert('Error: ' + (response.error || 'Upload failed'));
                    // Restore the original state
                    if (uploadBox) uploadBox.style.display = 'block';
                    if (processingEl) processingEl.style.display = 'none';
                }
            } catch (e) {
                console.error('Error parsing server response:', e); // Debugging statement
                alert('Error: Invalid server response');
                // Restore the original state
                if (uploadBox) uploadBox.style.display = 'block';
                if (processingEl) processingEl.style.display = 'none';
            }
        } else {
            alert('Error: Server returned status ' + xhr.status);
            // Restore the original state
            if (uploadBox) uploadBox.style.display = 'block';
            if (processingEl) processingEl.style.display = 'none';
        }
    };
    
    // Handle error
    xhr.onerror = function() {
        alert('Error: Network error during upload');
        // Restore the original state
        if (uploadBox) uploadBox.style.display = 'block';
        if (processingEl) processingEl.style.display = 'none';
    };
    
    // Send the request with CSRF token
    xhr.open('POST', '/documents/upload-document', true);
    
    // Add CSRF token header
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    xhr.setRequestHeader('X-CSRFToken', csrfToken);
    
    xhr.send(formData);
}

// Check document processing status with simplified UI
function checkDocumentProcessingImproved(docId, uploadBoxEl, fileName, attempts = 0, startTime = Date.now()) {
    const processingEl = document.getElementById('document-processing');
    
    // Maximum number of attempts (5 minutes)
    const maxAttempts = 60;
    // Minimum display time for processing indicator (4 seconds)
    const minDisplayTime = 4000;
    // Success message display time (3 seconds)
    const successMessageTime = 3000;
    
    if (attempts >= maxAttempts) {
        if (processingEl) processingEl.style.display = 'none';
        if (uploadBoxEl) uploadBoxEl.style.display = 'block';
        alert('Error: Document processing timed out. Please check back later.');
        loadDocuments();
        return;
    }
    
    // Check status
    fetch(`/documents/processing-status/${docId}`)
        .then(response => response.json())
        .then(data => {
            if (data.completed) {
                // Calculate elapsed time since start
                const elapsedTime = Date.now() - startTime;
                const remainingTime = Math.max(0, minDisplayTime - elapsedTime);
                
                // Wait for minimum display time, then show success message
                setTimeout(() => {
                    if (processingEl) {
                        // Show success message
                        processingEl.innerHTML = `
                            <div class="processing-indicator">
                                <div style="text-align: center; padding: 20px;">
                                    <h3 style="margin-bottom: 10px; color: #0c5460;">Your Bot is Smarter and Ready!</h3>
                                    <p>Visit the Playground to test it!</p>
                                </div>
                            </div>
                        `;
                        
                        // Wait 3 seconds with success message, then restore original UI
                        setTimeout(() => {
                            if (processingEl) processingEl.style.display = 'none';
                            if (uploadBoxEl) uploadBoxEl.style.display = 'block';
                            loadDocuments();
                        }, successMessageTime);
                    }
                }, remainingTime);
            } else {
                // Still processing, check again - use more frequent checks initially
                const checkInterval = attempts < 3 ? 1000 : 5000; // Check every 1s for first 3 attempts, then every 5s
                setTimeout(() => {
                    checkDocumentProcessingImproved(docId, uploadBoxEl, fileName, attempts + 1, startTime);
                }, checkInterval);
            }
        })
        .catch(error => {
            console.error('Error checking processing status:', error);
            // Continue polling even on error - use more frequent checks initially
            const checkInterval = attempts < 3 ? 1000 : 5000; // Check every 1s for first 3 attempts, then every 5s
            setTimeout(() => {
                checkDocumentProcessingImproved(docId, uploadBoxEl, fileName, attempts + 1, startTime);
            }, checkInterval);
        });
}

});

// View document
function viewDocument(docId) {
    fetch(`/documents/document/${docId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(doc => {
            const titleEl = document.getElementById('documentTitle');
            const contentEl = document.getElementById('documentContent');
            
            if (titleEl) titleEl.textContent = doc.doc_name;
            if (contentEl) contentEl.textContent = doc.content || 'No content available';
            
            // Show document modal
            showDocumentModal();
        })
        .catch(error => {
            console.error('Error viewing document:', error);
            alert('Error loading document content. Please try again.');
        });
}

// Delete document
function deleteDocument(docId, chatbotId) {
    // Get CSRF token from meta tag
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    fetch(`/documents/document/${docId}`, {
        method: 'DELETE',
        headers: { 
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({ chatbot_id: chatbotId })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(result => {
        if (result.success) {
            loadDocuments();
        } else {
            alert('Error deleting document: ' + (result.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error deleting document:', error);
        alert('Error deleting document. Please try again.');
    });
}

// Retrain agent
function retrainAgent() {
    const selectedBotName = document.getElementById('selected-bot-name');
    if (!selectedBotName) {
        alert('No chatbot selected for retraining.');
        return;
    }
    
    // Find the chatbot ID
    let chatbotId = '';
    const chatbotOptions = document.querySelectorAll('.bot-dropdown-content a');
    
    for (let option of chatbotOptions) {
        if (option.textContent.trim() === selectedBotName.textContent.trim()) {
            const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
            if (match && match[1]) {
                chatbotId = match[1];
                break;
            }
        }
    }
    
    if (!chatbotId) {
        alert('Error: Could not determine which chatbot to retrain.');
        return;
    }
    
    // Show loading state
    const retrainBtn = document.getElementById('retrain-agent-btn');
    const originalBtnText = retrainBtn.textContent;
    retrainBtn.disabled = true;
    retrainBtn.innerHTML = '<span class="spinner" style="width: 12px; height: 12px; margin-right: 5px;"></span> Retraining...';
    
    // Get CSRF token from meta tag
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    // Send retraining request
    fetch(`/documents/retrain-agent/${chatbotId}`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(result => {
        if (result.success) {
            alert('Agent retrained successfully');
        } else {
            alert('Error retraining agent: ' + (result.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error retraining agent:', error);
        alert('Error retraining agent. Please try again.');
    })
    .finally(() => {
        // Reset button state
        retrainBtn.disabled = false;
        retrainBtn.textContent = originalBtnText;
    });
}
</script>

<script>
// Leads Tab JavaScript

document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on the dashboard page
    if (!document.getElementById('leads')) return;
    
    // Table sorting functionality
    function setupTableSorting(tableId) {
        const table = document.getElementById(tableId);
        if (!table) return;
        
        const headers = table.querySelectorAll('th[data-sort]');
        
        headers.forEach(header => {
            header.addEventListener('click', function() {
                const sortKey = this.getAttribute('data-sort');
                const sortDirection = this.classList.contains('sort-asc') ? 'desc' : 'asc';
                
                // Remove sort classes from all headers
                headers.forEach(h => {
                    h.classList.remove('sort-asc', 'sort-desc');
                    h.querySelector('.sort-icon').textContent = '↕️';
                });
                
                // Add sort class to clicked header
                this.classList.add(`sort-${sortDirection}`);
                this.querySelector('.sort-icon').textContent = sortDirection === 'asc' ? '↑' : '↓';
                
                // Load leads with sort parameter
                loadLeads(sortKey, sortDirection);
            });
        });
    }
    
    // Updated loadLeads function with more robust error handling
    async function loadLeads(sortBy = 'created_at', sortDirection = 'desc') {
        try {
            const leadsTable = document.getElementById('leadsTable');
            const leadsTableBody = document.getElementById('leadsTableBody');
            const loadingIndicator = document.getElementById('leadsLoadingIndicator');
            const noLeadsMessage = document.getElementById('noLeadsMessage');
            const exportButton = document.getElementById('exportLeadsBtn');
            const errorMessage = document.getElementById('leadsErrorMessage');
            
            if (!leadsTableBody || !loadingIndicator || !noLeadsMessage) return;
            
            // Clear any previous error message
            if (errorMessage) {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
            }
            
            // Show loading indicator
            leadsTableBody.style.display = 'none';
            loadingIndicator.style.display = 'block';
            noLeadsMessage.style.display = 'none';
            
            // Hide export button until we know we have leads
            if (exportButton) {
                exportButton.style.display = 'none';
            }
            
            // Get the currently selected chatbot ID
            const selectedBotElement = document.getElementById('selected-bot-name');
            let chatbotId = '';
            
            if (selectedBotElement) {
                const botDropdownOptions = document.querySelectorAll('.bot-dropdown-content a');
                for (let option of botDropdownOptions) {
                    if (option.textContent.trim() === selectedBotElement.textContent.trim()) {
                        const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                        if (match && match[1]) {
                            chatbotId = match[1];
                            break;
                        }
                    }
                }
            }
            
            if (!chatbotId) {
                // No chatbot selected, show empty state
                leadsTableBody.innerHTML = '';
                leadsTableBody.style.display = 'none';
                loadingIndicator.style.display = 'none';
                noLeadsMessage.style.display = 'block';
                return;
            }
            
            // Fetch leads for this chatbot
            const response = await fetch(`/leads/list/${chatbotId}?sort=${sortBy}&direction=${sortDirection}`);
            
            // Check if the response is successful
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error);
            }
            
            leadsTableBody.innerHTML = '';
            loadingIndicator.style.display = 'none';
            
            if (!data.leads || data.leads.length === 0) {
                noLeadsMessage.style.display = 'block';
                leadsTable.style.display = 'none';
                return;
            }
            
            leadsTable.style.display = 'table';
            noLeadsMessage.style.display = 'none';
            leadsTableBody.style.display = 'table-row-group';
            
            if (exportButton) {
                exportButton.style.display = 'block';
            }
            
            data.leads.forEach((lead) => {
            // Format the date
            let formattedDate = '-';
            if (lead.created_at) {
                const date = new Date(lead.created_at);
                formattedDate = date.toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                }) + ' ' + date.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                }).toLowerCase();
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${lead.name || '-'}</td>
                <td>${lead.email || '-'}</td>
                <td>${lead.phone || '-'}</td>
                <td>${formattedDate}</td>
                <td class="text-end">
                    <button class="btn btn-sm btn-danger delete-lead-btn" data-lead-id="${lead.lead_id}">
                        Delete
                    </button>
                </td>
            `;
            
            leadsTableBody.appendChild(row);
        });
            
            setupDeleteButtons();
        } catch (error) {
            console.error('Error loading leads:', error);
            
            if (errorMessage) {
                errorMessage.style.display = 'block';
                errorMessage.textContent = `Error loading leads: ${error.message}. Please try again.`;
            }
            
            const leadsTableBody = document.getElementById('leadsTableBody');
            const exportButton = document.getElementById('exportLeadsBtn');
            if (leadsTableBody && leadsTableBody.children.length > 0 && exportButton) {
                exportButton.style.display = 'block';
            }
        }
    }

    
// Updated deleteLead function with correct API endpoint
async function deleteLead(leadId) {
        try {
            // Get CSRF token from meta tag
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            
            const response = await fetch(`/leads/delete/${leadId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Reload leads
                loadLeads();
            } else {
                alert('Error deleting lead: ' + (data.error || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error deleting lead:', error);
            alert('Error deleting lead. Please try again.');
        }
    }

    // Function to set up delete buttons for leads
    function setupDeleteButtons() {
        const deleteButtons = document.querySelectorAll('.delete-lead-btn');
        deleteButtons.forEach(button => {
            // Remove existing listeners to prevent multiple bindings
            button.removeEventListener('click', handleLeadDelete);
            button.addEventListener('click', handleLeadDelete);
        });
    }

    // Separate handler function for lead deletion
    function handleLeadDelete(e) {
        e.preventDefault();
        const leadId = this.getAttribute('data-lead-id');
        
        if (leadId) {
            if (confirm('Are you sure you want to delete this lead?')) {
                deleteLead(leadId);
            }
        }
    }
    
    // Updated exportLeads function with correct API endpoint
    async function exportLeads() {
        try {
            // Get the currently selected chatbot ID
            const selectedBotElement = document.getElementById('selected-bot-name');
            let chatbotId = '';
            
            if (selectedBotElement) {
                const botDropdownOptions = document.querySelectorAll('.bot-dropdown-content a');
                for (let option of botDropdownOptions) {
                    if (option.textContent.trim() === selectedBotElement.textContent.trim()) {
                        const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                        if (match && match[1]) {
                            chatbotId = match[1];
                            break;
                        }
                    }
                }
            }
            
            if (!chatbotId) {
                alert('No chatbot selected. Please select a chatbot first.');
                return;
            }
            
            // Trigger download by navigating to export URL
            window.location.href = `/leads/export/${chatbotId}`;
        } catch (error) {
            console.error('Error exporting leads:', error);
            alert('Error exporting leads. Please try again.');
        }
    }


    // Set up event listeners
    document.getElementById('exportLeadsBtn')?.addEventListener('click', exportLeads);
    
    // Setup table sorting
    setupTableSorting('leadsTable');
    
    // Initialize leads tab
    const leadsTabLink = document.querySelector('a[onclick="openPage(\'leads\')"]');
    if (leadsTabLink) {
        leadsTabLink.addEventListener('click', function() {
            loadLeads();
        });
    }
    
    // If leads tab is active on page load, load leads
    if (document.getElementById('leads').classList.contains('active')) {
        loadLeads();
    }
});
</script>

<script>
    // Chat Logs Tab JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Check if we're on the dashboard page
    if (!document.getElementById('chat-logs')) return;
    
    // Global variables for chat logs
    let activeThreadId = null;
    let chatbotConfig = null;
    
    // Initialize handlers for tab clicks
    const chatLogsTabLink = document.querySelector('a[onclick="openPage(\'chat-logs\')"]');
    if (chatLogsTabLink) {
        chatLogsTabLink.addEventListener('click', function() {
            loadChatThreads();
        });
    }
    
    function loadChatThreads() {
        // Get the currently selected chatbot ID
        const selectedBotElement = document.getElementById('selected-bot-name');
        let chatbotId = '';
        
        if (selectedBotElement) {
            const botDropdownOptions = document.querySelectorAll('.bot-dropdown-content a');
            for (let option of botDropdownOptions) {
                if (option.textContent.trim() === selectedBotElement.textContent.trim()) {
                    const match = option.getAttribute('onclick').match(/selectBot\('([^']+)'/);
                    if (match && match[1]) {
                        chatbotId = match[1];
                        break;
                    }
                }
            }
        }
        
        if (!chatbotId) {
            // No chatbot selected, show empty state
            document.getElementById('threadsList').innerHTML = '';
            document.getElementById('messagesList').innerHTML = '';
            document.getElementById('noThreadsMessage').style.display = 'block';
            document.getElementById('threadsLoadingIndicator').style.display = 'none';
            document.getElementById('noMessagesMessage').style.display = 'block';
            document.getElementById('messagesLoadingIndicator').style.display = 'none';
            return;
        }
        
        // Fetch chatbot configuration for avatar and styling
        fetchChatbotConfig(chatbotId);
        
        // Show loading indicator and hide messages
        document.getElementById('threadsList').innerHTML = '';
        document.getElementById('noThreadsMessage').style.display = 'none';
        document.getElementById('threadsLoadingIndicator').style.display = 'block';
        
        // Clear message area and show placeholder
        document.getElementById('messagesList').innerHTML = '';
        document.getElementById('noMessagesMessage').style.display = 'block';
        document.getElementById('messagesLoadingIndicator').style.display = 'none';
        
        // Fetch threads from the server
        fetch(`/metrics/chatbot-threads/${chatbotId}?limit=50&since=30d`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Enhanced debugging for thread timestamps
                console.log('===== THREAD DATA FROM API =====');
                console.log('Raw API response:', data);
                
                if (data.threads && data.threads.length > 0) {
                    const thread = data.threads[0]; // Look at first thread
                    console.log('First thread data:', thread);
                    console.log('Thread ID:', thread.thread_id);
                    console.log('Last activity (raw):', thread.last_activity);
                    console.log('Last activity format:', typeof thread.last_activity);
                    
                    // Try parsing it different ways
                    console.log('Parsed as local:', new Date(thread.last_activity).toString());
                    console.log('Parsed as local ISO:', new Date(thread.last_activity).toISOString());
                    console.log('Current local time:', new Date().toString());
                    
                    // Calculate UTC offset for local timezone
                    const offset = new Date().getTimezoneOffset();
                    console.log('Local timezone offset (minutes):', offset);
                    console.log('===== END THREAD DATA DEBUG =====');
                }
                
                // Hide loading indicator
                document.getElementById('threadsLoadingIndicator').style.display = 'none';
                
                // Process the threads data
                if (!data.threads || data.threads.length === 0) {
                    document.getElementById('noThreadsMessage').style.display = 'block';
                    return;
                }
                
                // Clear any previous content
                const threadsContainer = document.getElementById('threadsList');
                threadsContainer.innerHTML = '';
                
                // Sort threads by last_activity (newest first)
                const sortedThreads = data.threads.sort((a, b) => {
                    return Date.parse(b.last_activity) - Date.parse(a.last_activity);
                });
                
                // Add threads to the container
                sortedThreads.forEach((thread, index) => {
                    const threadElement = createThreadElement(thread);
                    threadsContainer.appendChild(threadElement);
                    
                    // Auto-select the first (newest) thread
                    if (index === 0) {
                        threadElement.classList.add('active');
                        activeThreadId = thread.thread_id;
                        loadThreadMessages(activeThreadId);
                    }
                });
            })
            .catch(error => {
                console.error('Error loading chat threads:', error);
                document.getElementById('threadsLoadingIndicator').style.display = 'none';
                document.getElementById('noThreadsMessage').style.display = 'block';
                document.getElementById('noThreadsMessage').innerHTML = `
                    <h4>Error loading threads</h4>
                    <p class="text-muted">There was a problem loading the chat threads. Please try again.</p>
                `;
            });
    }
    
    // Fetch chatbot configuration
    async function fetchChatbotConfig(chatbotId) {
        try {
            const response = await fetch(`/config/chatbot/${chatbotId}`);
            
            // Default config if API call fails
            if (!response.ok) {
                chatbotConfig = {
                    icon_image_url: 'https://res.cloudinary.com/dd19jhkar/image/upload/v1735504762/enfadxyhjtjkwdivbuw4.png',
                    chat_title: 'Agent d-A-v-I-d'
                };
                return;
            }
            
            const config = await response.json();
            
            // Validate the icon URL
            if (config.icon_image_url && 
                typeof config.icon_image_url === 'string' && 
                config.icon_image_url.trim() !== '' &&
                (config.icon_image_url.startsWith('https://') || config.icon_image_url.startsWith('http://'))) {
                // Update CSS for assistant messages
                const newAvatarRule = `.message-bubble.assistant::before { background-image: url('${config.icon_image_url}'); }`;
                
                // Check if we already have a style element for this
                let styleEl = document.getElementById('chat-avatar-style');
                if (!styleEl) {
                    styleEl = document.createElement('style');
                    styleEl.id = 'chat-avatar-style';
                    document.head.appendChild(styleEl);
                }
                
                styleEl.textContent = newAvatarRule;
            }
            
            chatbotConfig = config;
            
        } catch (error) {
            console.error('Error fetching chatbot config:', error);
            chatbotConfig = {
                icon_image_url: 'https://res.cloudinary.com/dd19jhkar/image/upload/v1735504762/enfadxyhjtjkwdivbuw4.png',
                chat_title: 'Agent d-A-v-I-d'
            };
        }
    }
    
// Create a thread element
function createThreadElement(thread) {
    const elem = document.createElement('div');
    elem.className = 'thread-item';
    elem.setAttribute('data-thread-id', thread.thread_id);

    // Get the first message preview (need to fetch thread messages)
    let previewText = 'Loading preview...';

    // Format the last activity time as relative time
    const lastActivity = new Date(thread.last_activity);
    const relativeTime = formatRelativeTime(lastActivity.toISOString());

    elem.innerHTML = `
        <div>
            <div class="thread-preview">${previewText}</div>
            <div class="thread-time">${relativeTime} · ${thread.message_count} messages</div>
        </div>
    `;

    // Fetch thread preview (first message)
    fetchThreadPreview(thread.thread_id, elem);

    // Add event listener for thread selection
    elem.addEventListener('click', function() {
        // Skip if already active
        if (this.classList.contains('active')) return;

        // Remove active class from all threads
        document.querySelectorAll('.thread-item').forEach(item => {
            item.classList.remove('active');
        });

        // Add active class to this thread
        this.classList.add('active');

        // Load messages for this thread
        activeThreadId = thread.thread_id;
        loadThreadMessages(activeThreadId);
    });

    return elem;
}




    
    // Fetch preview for a thread
    async function fetchThreadPreview(threadId, threadElement) {
        try {
            const response = await fetch(`/metrics/thread-messages/${threadId}?limit=1`);
            
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            
            if (data.messages && data.messages.length > 0) {
                const firstMessage = data.messages[0];
                const previewText = firstMessage.user_message.substring(0, 50) + 
                    (firstMessage.user_message.length > 50 ? '...' : '');
                
                // Update the preview text
                const previewElement = threadElement.querySelector('.thread-preview');
                if (previewElement) {
                    previewElement.textContent = previewText;
                }
            }
        } catch (error) {
            console.error(`Error fetching preview for thread ${threadId}:`, error);
        }
    }
    
    function loadThreadMessages(threadId) {
        // Show loading indicator
        document.getElementById('messagesList').innerHTML = '';
        document.getElementById('noMessagesMessage').style.display = 'none';
        document.getElementById('messagesLoadingIndicator').style.display = 'block';
        
        fetch(`/metrics/thread-messages/${threadId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Hide loading indicator
                document.getElementById('messagesLoadingIndicator').style.display = 'none';
                
                // Debug raw messages data
                console.log('Messages from API:', data);
                
                // Process the messages data
                if (!data.messages || data.messages.length === 0) {
                    document.getElementById('noMessagesMessage').style.display = 'block';
                    return;
                }
                
                // Prepare messages container
                const messagesContainer = document.getElementById('messagesList');
                messagesContainer.innerHTML = '';
                
                // Create container for proper styling
                const messageContainer = document.createElement('div');
                messageContainer.className = 'message-container';
                messagesContainer.appendChild(messageContainer);
                
                // Add messages to the container
                data.messages.forEach(message => {
                    // Fix timestamp for proper timezone display
                    let timestamp;
                    
                    if (message.created_at) {
                        const dateStr = message.created_at;
                        console.log('Message timestamp from API:', dateStr);
                        
                        // Handle different timestamp formats from different database types
                        if (dateStr.includes('T') && dateStr.includes('Z')) {
                            // Already ISO format with Z - correct the double UTC conversion
                            const parsedDate = new Date(dateStr);
                            // Apply offset correction to convert from UTC to local time
                            const offsetMinutes = new Date().getTimezoneOffset();
                            timestamp = new Date(parsedDate.getTime() - (offsetMinutes * 60 * 1000));
                            console.log('Corrected ISO+Z timestamp:', dateStr, '->', timestamp.toString());
                        } 
                        else if (dateStr.includes('T')) {
                            // ISO format without Z
                            timestamp = new Date(dateStr);
                            console.log('Parsed ISO timestamp:', dateStr, '->', timestamp.toString());
                        }
                        else if (dateStr.includes(' ')) {
                            // Raw SQL format (YYYY-MM-DD HH:MM:SS) - convert to ISO with Z
                            const utcStr = dateStr.replace(' ', 'T') + 'Z';
                            timestamp = new Date(utcStr);
                            console.log('Converted SQL timestamp:', dateStr, '->', utcStr, '->', timestamp.toString());
                        }
                        else {
                            // Other format - let JavaScript handle it
                            timestamp = new Date(dateStr);
                            console.log('Parsed other timestamp format:', dateStr, '->', timestamp.toString());
                        }
                    } else {
                        // No timestamp provided
                        timestamp = new Date();
                        console.log('No timestamp found, using current time');
                    }
                    
                    // Check for very future timestamps (likely timezone issues)
                    const now = new Date();
                    const diffMs = now - timestamp;
                    if (diffMs < -3600000) { // More than an hour in the future
                        console.log('Detected future timestamp, applying additional correction');
                        // This is a last resort correction - apply a timezone offset to fix it
                        const offsetHours = Math.round(Math.abs(diffMs) / 3600000);
                        timestamp = new Date(timestamp.getTime() - (offsetHours * 3600 * 1000));
                        console.log('After additional correction:', timestamp.toString());
                    }
                    
                    // Add user message
                    if (message.user_message) {
                        const userMessageElement = createMessageElement(message.user_message, 'user', timestamp);
                        messageContainer.appendChild(userMessageElement);
                    }
                    
                    // Add assistant message - use the same timestamp for both messages
                    if (message.assistant_response) {
                        const assistantMessageElement = createMessageElement(message.assistant_response, 'assistant', timestamp);
                        messageContainer.appendChild(assistantMessageElement);
                    }
                });
                
                // Scroll to the bottom of the messages
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            })
            .catch(error => {
                console.error('Error loading thread messages:', error);
                document.getElementById('messagesLoadingIndicator').style.display = 'none';
                document.getElementById('noMessagesMessage').style.display = 'block';
                document.getElementById('noMessagesMessage').innerHTML = `
                    <h4>Error loading messages</h4>
                    <p class="text-muted">There was a problem loading the conversation. Please try again.</p>
                `;
            });
    }
    
// Create a message element
function createMessageElement(content, role, timestamp) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${role}`;
    
    const messageBubble = document.createElement('div');
    messageBubble.className = `message-bubble ${role}`;
    
    // Handle markdown for assistant messages
    if (role === 'assistant') {
        // Check if marked library is available
        if (typeof marked !== 'undefined') {
            messageBubble.innerHTML = marked.parse(content);
        } else {
            // Fallback to simple text with line breaks
            messageBubble.textContent = content;
        }
    } else {
        // User messages are plain text
        messageBubble.textContent = content;
    }
    
    messageDiv.appendChild(messageBubble);
    
    // Add timestamp - convert to local time if needed
    const timeElement = document.createElement('div');
    timeElement.className = 'message-time';
    timeElement.textContent = formatMessageTime(timestamp);
    messageDiv.appendChild(timeElement);
    
    return messageDiv;
}

// Format message time
function formatMessageTime(date) {
    // Ensure we have a valid date object
    if (!(date instanceof Date) || isNaN(date.getTime())) {
        console.error('Invalid date for formatting:', date);
        return 'unknown time';
    }
    
    // Format the date and time for display
    // This will use the browser's locale settings to format according to user's preferences
    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + 
        ' · ' + 
        date.toLocaleDateString([], { month: 'short', day: 'numeric' });
}
    
// Format relative time (e.g., "2 hours ago")
function formatRelativeTime(dateStr) {
    try {
        const now = new Date();
        let timestamp;
        
        if (typeof dateStr !== 'string') {
            console.error('Invalid date input type:', typeof dateStr);
            return 'unknown time';
        }
        
        // Handle different timestamp formats
        if (dateStr.includes(' ') && !dateStr.includes('T')) {
            // Raw SQL format (YYYY-MM-DD HH:MM:SS) - assume UTC
            const utcStr = dateStr.replace(' ', 'T') + 'Z';
            timestamp = new Date(utcStr);
            console.log('Format #1 - SQL to UTC:', dateStr, '->', utcStr, '->', timestamp.toString());
        } 
        else if (dateStr.includes('T') && dateStr.includes('Z')) {
            // Already ISO format with Z - explicitly parse as UTC
            timestamp = new Date(dateStr);
            
            // Fix for timezone offset issue - convert to actual local time
            // Subtract timezone offset to get actual time
            const offsetMs = now.getTimezoneOffset() * 60 * 1000;
            timestamp = new Date(timestamp.getTime() - offsetMs);
            
            console.log('Format #2 - ISO with Z (fixed):', dateStr, '->', timestamp.toString());
        }
        else {
            // Other formats - let JavaScript handle
            timestamp = new Date(dateStr);
            console.log('Format #3 - Other:', dateStr, '->', timestamp.toString());
        }
        
        // Ensure the date is valid
        if (isNaN(timestamp.getTime())) {
            console.error('Invalid date string:', dateStr);
            return 'unknown time';
        }

        // Calculate time difference - now with accurate timestamp
        const diffMs = now - timestamp;
        
        // Debug info
        console.log('Final time calculation:');
        console.log('- Original string:', dateStr);
        console.log('- Parsed timestamp:', timestamp.toString());
        console.log('- Current time:', now.toString());
        console.log('- Time difference (ms):', diffMs);
        
        // Standard time difference calculations
        const diffSecs = Math.floor(diffMs / 1000);
        const diffMins = Math.floor(diffSecs / 60);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);

        if (diffSecs < 60) {
            return 'just now';
        } else if (diffMins < 60) {
            return diffMins + ' min' + (diffMins !== 1 ? 's' : '') + ' ago';
        } else if (diffHours < 24) {
            return diffHours + ' hour' + (diffHours !== 1 ? 's' : '') + ' ago';
        } else if (diffDays < 30) {
            return diffDays + ' day' + (diffDays !== 1 ? 's' : '') + ' ago';
        } else {
            // Format as date
            return timestamp.toLocaleDateString();
        }
    } catch (error) {
        console.error('Error formatting relative time:', error);
        return 'unknown time';
    }
}
    
    // Format message time
    function formatMessageTime(date) {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + 
               ' · ' + 
               date.toLocaleDateString([], { month: 'short', day: 'numeric' });
    }
    
    // Shorten thread ID for display
    function shortenThreadId(threadId) {
        // If it starts with "thread_", remove it
        if (threadId.startsWith('thread_')) {
            threadId = threadId.substring(7);
        }
        
        // If it's a timestamp, convert to date
        if (!isNaN(threadId)) {
            const date = new Date(parseInt(threadId));
            return date.toLocaleDateString();
        }
        
        // Otherwise, just show first 8 chars
        return threadId.substring(0, 8);
    }
    
    // Initialize when a chatbot is selected
    function initChatLogs() {
        document.querySelectorAll('.bot-dropdown-content a').forEach(option => {
            option.addEventListener('click', function() {
                if (document.getElementById('chat-logs').classList.contains('active')) {
                    // If chat logs tab is active, reload threads for the new chatbot
                    setTimeout(loadChatThreads, 100);
                }
            });
        });
    }
    
    // Initialize chat logs module
    initChatLogs();
    
    // If chat logs tab is active on page load, load threads
    if (document.getElementById('chat-logs').classList.contains('active')) {
        loadChatThreads();
    }
});
</script>

<script>
// Mobile Menu JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Remove any mobile toggle button functionality
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    if (mobileMenuToggle) {
        mobileMenuToggle.remove();
    }
    
    // Ensure the nav-container is visible
    const navContainer = document.querySelector('.nav-container');
    if (navContainer) {
        navContainer.style.display = 'block';
    }
    
    // Handle dropdown menus (if used)
    const dropdownLinks = document.querySelectorAll('.nav-links > li:has(.dropdown-content) > a');
    dropdownLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // Only handle dropdown on desktop, let mobile use default behavior
            if (window.innerWidth > 768) {
                const parentLi = this.parentElement;
                parentLi.classList.toggle('dropdown-active');
            }
        });
    });
    
    // Auto-scroll to active tab on page load or when tab changes
    function scrollToActiveTab() {
        const activeTab = document.querySelector('.nav-links a.active');
        if (activeTab && navContainer) {
            // Get the position of the active tab relative to its container
            const tabPosition = activeTab.offsetLeft;
            const containerWidth = navContainer.offsetWidth;
            
            // Calculate scroll position to center the active tab
            const scrollPosition = tabPosition - (containerWidth / 2) + (activeTab.offsetWidth / 2);
            
            // Smoothly scroll to the active tab
            navContainer.scrollTo({
                left: Math.max(0, scrollPosition),
                behavior: 'smooth'
            });
        }
    }
    
    // Add click handlers to all nav links to trigger scroll after page changes
    const navLinks = document.querySelectorAll('.nav-links a');
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            // Short delay to allow the active class to be applied
            setTimeout(scrollToActiveTab, 100);
        });
    });
    
    // Call on initial load
    setTimeout(scrollToActiveTab, 300);
    
    // Call when window is resized
    window.addEventListener('resize', scrollToActiveTab);
});

// Settings Mobile Navigation
document.addEventListener('DOMContentLoaded', function() {
    // Create the mobile nav toggle button
    const settingsPage = document.getElementById('settings');
    const settingsNav = document.querySelector('.settings-nav');
    
    if (settingsPage && settingsNav) {
        // Create the toggle button element
        const mobileNavToggle = document.createElement('button');
        mobileNavToggle.className = 'settings-mobile-nav-toggle';
        mobileNavToggle.textContent = 'Settings Menu';
        mobileNavToggle.type = 'button';
        
        // Get the settings layout element to insert the toggle before the nav
        const settingsLayout = document.querySelector('.settings-layout');
        
        if (settingsLayout) {
            // Insert the toggle button before the settings layout
            settingsLayout.parentNode.insertBefore(mobileNavToggle, settingsLayout);
            
            // Add click event to toggle the nav
            mobileNavToggle.addEventListener('click', function() {
                settingsNav.classList.toggle('active');
                this.textContent = settingsNav.classList.contains('active') ? 'Hide Menu' : 'Settings Menu';
            });
            
            // Close menu when a nav item is clicked
            const navItems = settingsNav.querySelectorAll('.settings-nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        settingsNav.classList.remove('active');
                        mobileNavToggle.textContent = 'Settings Menu';
                    }
                });
            });
        }
    }
});

</script>


<script>
    window.davesEasySupportChatConfig = {
        chatbotId: "92ddde3c7c7d4ed19651",
        baseUrl: "https://goeasychat.com",
        // baseUrl: "http://127.0.0.1:8080/",
        // showInitialMessage: false
    };
</script>
<script src="https://goeasychat.com/static/js/chatbot-embed-support.js" defer></script>
<!--
<script src="http://127.0.0.1:8080/static/js/chatbot-embed-support.js" defer></script>
-->
    <script src="/static/js/csrf.js"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>